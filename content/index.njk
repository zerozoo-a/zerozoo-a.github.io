---
layout: layouts/home.njk
pagination:
  data: collections.myCustomSort
  size: 5
permalink: ./{% if pagination.pageNumber > 0 %}page{{ pagination.pageNumber }}/{% endif %}index.html
---
{% set postsCount = collections.posts | length %}
{% set latestPostsCount = postsCount | min(numberOfLatestPostsToShow) %}
{% set postslistCounter = postsCount %}
{% set pageNumber = pagination.pageNumber %}
<div class="posts-container">
  <ol style="counter-reset: start-from {{ postslistCounter + 1 - (pagination.pageNumber * 5) }}" >
    <li>
    {% for item in pagination.items %}
        <a href="{{ item.page.url }}">
        <div class="p-3 d-flex color-bg-default Box m-3">
          {% if(item.data.cover) %}
            <img class="cover-img" src="/covers/{{item.data.cover}}" alt="cover image" height="auto" loading="lazy" decoding="async"/>
          {% elif(item.data.coverURL) %}
            {# <img class="cover-img" src="{{item.data.coverURL}}" alt="cover image" height="auto" loading="lazy" decoding="async"/> #}
            <img class="cover-img" src={% convert item.data.coverURL %} alt="cover image" height="auto" />
          {% endif %}

          {# <div class="d-flex p-3 flex-direction-col">
              <h3 class="d-flex flex-items-center">
                  {% if item.data.title %}{{ item.data.title }}{% else %}<code>{{ item.url }}</code>{% endif %}
              </h3>
            <div> #}
          <div class="d-flex pl-3 pb-3 pr-3 flex-direction-col">
              <h3 class="d-flex flex-items-center">
                  {% if item.data.title %}{{ item.data.title }}{% else %}<code>{{ item.url }}</code>{% endif %}
              </h3>
            <div>
              <time class="postlist-date" datetime="{{ item.date | htmlDateString }}">Created at: {{ item.page.date | readableDate("yyyy년 LL월 dd일 hh시 mm분 ss초") }}</time>
            </div>
          </div>
        </div>
        </a>
    {% endfor %}
    </ol>
    </li>
</div>
<div class="wrapper">
  <ul id="pagination" class="sticky-bottom-nav"></ul>
</div>

{% set _pagination =  pagination.links | dump %}
{% set paginationLinks = pagination.links %}

<script type="text/javascript">
  const pageLinks = `{{_pagination}}`.replaceAll('&quot;','').replaceAll('[','').replaceAll(']','').split(',')
  const postsCount = {{postsCount}}
  let allPages = pageLinks.length
  const pagination = document.getElementById("pagination")
  const NOTHING_BUTTON = (dir='<')=>`<li class="btn">${dir}</li>`
  const pageNumber = {{pageNumber}}

  function elem(allPages = pageLinks.length, page) {
    let li = "";
    let beforePages = page - 1;
    let afterPages = page + 1;
    let liActive;

    let spaceStack = [];


  if (page > 0) {
    li += `
    <li class="btn" onclick="elem(allPages, ${
      0
    })" >
    <a href="${pageLinks.at(0)}">
      <span> << </span>
    </a>
    </li>
    <li class="btn" onclick="elem(allPages, ${
      page - 1
    })" >
    <a href="${pageLinks[page - 2] ?? pageLinks[page-1]}">
      <span> < </span>
    </a>
    </li>
    `;
    spaceStack.push(1)
  } else {
    li += NOTHING_BUTTON('_')
    spaceStack.push(1)
  }

  for (let currentPage = beforePages; currentPage <= afterPages; currentPage++) {

    if (currentPage > allPages ) {
      continue;
    }

    if (currentPage == -1) {
      currentPage = currentPage + 1;
    }

    if (page == currentPage) {
      liActive = "active";
    } else {
      liActive = "";
    }

    /**
    * 마지막 페이지의 pagination
    */
    if(page == allPages - 1) {
    li += `
    <li class="numb active" onclick="elem(allPages, ${currentPage})">
        <a href="${pageLinks[currentPage]}">
         <span>
          ${afterPages}
         </span>
        </a>
      </li>
      `;
      spaceStack.push(1)
      break;
    }
    /**
     * 첫 페이지의 pagination
     */
    li += `
    <li class="numb ${liActive}" onclick="elem(allPages, ${currentPage})" >
      <a href="${pageLinks[currentPage]}">
      <span>
        ${currentPage + 1}
      </span>
      </a>
      </li>
      `;
    spaceStack.push(1)
  }

  if(page == 0) {
    li += `
    <li class="numb" onclick="elem(allPages, ${afterPages + 1})">
      <a href="${pageLinks[afterPages + 1]}">
      <span>
        ${afterPages + 2}
      </span>
      </a>
    </li>
      `;
    spaceStack.push(1)
  }

  if (page < allPages && page !== allPages - 1) {
    li += `
    <li class="btn" onclick="elem(allPages, ${
        page + 1
      })" >
      <a href="${pageLinks[afterPages + 2] ?? pageLinks[afterPages + 1]}">
        <span> > </span>
      </a>
    </li>
    `;
    li += `
    <li class="btn" onclick="elem(allPages, ${
      allPages
      })" >
      <a href="${pageLinks.at(-1)}">
        <span> >> </span>
      </a>
    </li>
    `;
    spaceStack.push(1)
  } else {
    while(spaceStack.length < 5) {
      li += NOTHING_BUTTON('_')
      spaceStack.push(1)
    }
  }

  pagination.innerHTML = li;
}
elem(allPages, {{pageNumber}});
</script>




